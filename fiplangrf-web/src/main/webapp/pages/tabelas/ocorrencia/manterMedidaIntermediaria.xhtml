<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:p="http://primefaces.org/ui"
	xmlns:cfw="http://ceprofw.cepromat.mt.gov.br/components"
	xmlns:sind="http://ceprofw.cepromat.mt.gov.br/sindesa">

	<p:dialog id="dlgFormMedidaIntermediaria" modal="true" width="90%"
		responsive="true" widgetVar="dlgFormMedidaIntermediaria"
		draggable="false" resizable="false">
		<cfw:panel idPanel="panelMedidaIntermediaria" focus="false"
			titulo="Medida Intermediária" icone="">

			<cfw:panelFloat showMessage="false">

				<p:messages id="idMessageFormMedidaIntermediaria"
					style="padding:0px 10px;" />

				<cfw:formInputTextArea labelValue="Descrição"
					containerWidth="Container99" responsive="false"
					value="#{manterOcorrenciaBean.medidaIntermediaria.descricao}"
					readonly="#{!((manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao and manterOcorrenciaBean.medidaIntermediaria.id eq null)}"
					maxlength="2000" />

				<cfw:formInputText labelValue="Responsável"
					value="#{manterOcorrenciaBean.medidaIntermediaria.nomeResponsavel}"
					readonly="#{!((manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao and manterOcorrenciaBean.medidaIntermediaria.id eq null)}"
					containerWidth="Container50" responsive="false" maxlength="50" />

				<cfw:formInputText labelValue="Cargo/Função"
					value="#{manterOcorrenciaBean.medidaIntermediaria.cargoFuncao}"
					readonly="#{!((manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao and manterOcorrenciaBean.medidaIntermediaria.id eq null)}"
					containerWidth="Container50" responsive="false" maxlength="50" />


				<cfw:formInputTelefone labelValue="Telefone"
					containerWidth="Container50" responsive="false"
					readonly="#{!((manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao and manterOcorrenciaBean.medidaIntermediaria.id eq null)}"
					value="#{manterOcorrenciaBean.medidaIntermediaria.numrTelefone}" />

				<cfw:formInputEmail labelValue="Email" containerWidth="Container50"
					responsive="false"
					readonly="#{!((manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao and manterOcorrenciaBean.medidaIntermediaria.id eq null)}"
					value="#{manterOcorrenciaBean.medidaIntermediaria.email}"></cfw:formInputEmail>

				<cfw:container containerWidth="Container100">
					<p:dataTable id="idAnexosMedidaIntermediaria"
						emptyMessage="Sem Registros"
						value="#{manterOcorrenciaBean.medidaIntermediaria.anexos}"
						var="anexo">
						<f:facet name="header">
							<h:outputText value="Documentos Anexos" style="margin-right:5px;" />
						</f:facet>

						<p:column headerText="Data" width="140">
							<h:outputText value="#{anexo.dataCriacao}">
								<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
							</h:outputText>
						</p:column>

						<p:column headerText="Usuário"
							style="white-space: normal; word-wrap: break-word;">
							<h:outputText value="#{anexo.usuario.fiplanUsuario.nome}" />
						</p:column>

						<p:column headerText="Anexo"
							style="white-space: normal; word-wrap: break-word;">
							<h:outputText value="#{anexo.descricao}" />
						</p:column>

						<p:column width="90" headerText="Ações">
							<center>
								<p:commandButton id="downloadAnexo" immediate="true"
									ajax="false" title="Download Anexo"
									icon="ui-icon-edit fa fa-download white Fs10"
									onclick="PrimeFaces.monitorDownload(start, stop);"
									actionListener="#{manterOcorrenciaBean.anexoBeanHelper.downloadAnexo(anexo)}">
									<p:fileDownload
										value="#{manterOcorrenciaBean.anexoBeanHelper.file}" />
								</p:commandButton>

								<p:commandButton icon="fa fa-trash white Fs10"
									action="#{manterOcorrenciaBean.removerAnexoMedidaIntermediaria(anexo)}"
									process="@([id$=idAnexosMedidaIntermediaria])"
									update="@([id$=idAnexosMedidaIntermediaria]) @([id$=dlgConfirmAnexo])"
									rendered="#{(manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and anexo.id eq null}">
									<p:confirm header="Excluir Anexo"
										message="Deseja realmente excluir o anexo?"
										icon="ui-icon-alert" />
								</p:commandButton>
							</center>
						</p:column>
					</p:dataTable>
					<div class="ui-grid-row">
						<!-- 20971520 = 20 Megabyte	-->
						<p:fileUpload id="fileuploadAnexo" label="Anexar"
							cancelLabel="Cancelar" widgetVar="fileuploadAnexo"
							styleClass="Container100 Responsive100" process="@form"
							sizeLimit="20971520" auto="true"
							invalidSizeMessage="Tamanho máximo permitido 20MB "
							invalidFileMessage="Anexar apenas arquivo do tipo PDF ou Excel"
							multiple="true" allowTypes="/(\.|\/)(pdf|xls|xlsx)$/"
							fileUploadListener="#{manterOcorrenciaBean.uploadAnexoMedidaIntermediaria}"
							rendered="#{(manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao and manterOcorrenciaBean.medidaIntermediaria.id eq null}"
							update="#{p:component('idAnexosMedidaIntermediaria')}" />
					</div>
				</cfw:container>

				<cfw:formSelectOneMenu id="situacaoMedidaIntermediaria"
					labelValue="Situação" containerWidth="Container50"
					responsive="false"
					value="#{manterOcorrenciaBean.medidaIntermediaria.situacao}"
					itemsValue="#{combosEnumHelperBean.dominioSituacao}"
					itemLabel="#{item.desc}" itemValue="#{item}" itemVar="item"
					readonly="#{!(manterOcorrenciaBean.modoOperacao eq 'ALTERACAO' and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao)}"
					required="false" />

				<cfw:formCalendar labelValue="Data de Cadastro"
					containerWidth="Container50 noResponsive"
					pattern="dd/MM/yyyy HH:mm:ss"
					value="#{manterOcorrenciaBean.medidaIntermediaria.dataCriacao}"
					rendered="#{manterOcorrenciaBean.modoOperacao ne 'INCLUSAO'}"
					readonly="true" required="true" />

				<cfw:formCalendar labelValue="Data da Última Alteração"
					containerWidth="Container50 noResponsive"
					pattern="dd/MM/yyyy HH:mm:ss"
					value="#{manterOcorrenciaBean.medidaIntermediaria.dataAtualizacao}"
					rendered="#{manterOcorrenciaBean.modoOperacao ne 'INCLUSAO'}"
					readonly="true" />
			</cfw:panelFloat>

			<cfw:panelButtons id="buttons">
				<p:outputPanel id="molduraBotoesMedidaIntermediaria"
					styleClass="ui-ceprofw-panel-botoes" layout="block">

					<p:commandButton value="Concluir"
						actionListener="#{manterOcorrenciaBean.closeMedidaIntermediaria}"
						process="@([id$=dlgFormMedidaIntermediaria])"
						update="@([id$=panelMedidaIntermediaria]) @([id$=tableMedidaIntermediaria]) @([id$=idMessageFormMedidaIntermediaria])"
						icon="fa fa-plus white Fs14" styleClass="ResponsiveButton"
						rendered="#{manterOcorrenciaBean.modoOperacao eq 'ALTERACAO' and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao}"
						onstart="showWaitStatus()" oncomplete="hideWaitStatus()">
					</p:commandButton>

					<p:commandButton value="Concluir"
						actionListener="#{manterOcorrenciaBean.incluirMedidaIntermediaria}"
						process="@([id$=dlgFormMedidaIntermediaria])"
						update="@([id$=panelMedidaIntermediaria]) @([id$=tableMedidaIntermediaria]) @([id$=idMessageFormMedidaIntermediaria])"
						icon="fa fa-plus white Fs14" styleClass="ResponsiveButton"
						rendered="#{manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao}"
						onstart="showWaitStatus()" oncomplete="hideWaitStatus()" />

					<p:commandButton value="Limpar"
						actionListener="#{manterOcorrenciaBean.limparMedidaIntermediaria}"
						process="@([id$=dlgFormMedidaIntermediaria])"
						update="@([id$=panelMedidaIntermediaria]) @([id$=tableMedidaIntermediaria]) @([id$=idMessageFormMedidaIntermediaria])"
						icon="fa fa-plus white Fs14" styleClass="ResponsiveButton"
						rendered="#{manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' and manterOcorrenciaBean.ocorrencia.situacaoEmRegularizacao}"
						onstart="showWaitStatus()" oncomplete="hideWaitStatus()" />

					<p:commandButton value="Cancelar" title="Cancelar" process="@this"
						update="@([id$=dlgFormMedidaIntermediaria])"
						actionListener="#{manterOcorrenciaBean.closeMedidaIntermediaria}"
						icon="fa fa-close white Fs14" />
				</p:outputPanel>
			</cfw:panelButtons>
		</cfw:panel>
	</p:dialog>
</ui:composition>