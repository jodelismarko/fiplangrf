<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:p="http://primefaces.org/ui"
	xmlns:cfw="http://ceprofw.cepromat.mt.gov.br/components"
	xmlns:sind="http://ceprofw.cepromat.mt.gov.br/sindesa">

	<p:dialog id="dlgFormAcaoCoordenadoria" modal="true" width="90%"
		responsive="true" widgetVar="dlgFormAcaoCoordenadoria"
		draggable="false" resizable="false">

		<cfw:panel idPanel="panelAcaoCoordenadoria" focus="false"
			titulo="Ação Coordenadoria" icone="">

			<cfw:panelFloat showMessage="false">

				<p:messages id="idMessageFormAcaoCoordenadoria"
					style="padding:0px 10px;" />

				<cfw:formInputTextArea labelValue="Descrição"
					value="#{manterOcorrenciaBean.acaoCoordenadoria.descricao}"
					readonly="#{!((manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoPendente and manterOcorrenciaBean.acaoCoordenadoria.id eq null)}"
					containerWidth="Container100" responsive="false" maxlength="2000" />

				<cfw:container containerWidth="Container100">
					<p:dataTable id="idAnexosAcaoCoordenadoria"
						emptyMessage="Sem Registros" var="anexo"
						value="#{manterOcorrenciaBean.acaoCoordenadoria.anexos}">

						<f:facet name="header">
							<h:outputText value="Documentos Anexos" />
						</f:facet>

						<p:column headerText="Data" width="140">
							<h:outputText value="#{anexo.dataCriacao}">
								<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
							</h:outputText>
						</p:column>

						<p:column headerText="Usuário"
							style="white-space: normal; word-wrap: break-word;">
							<h:outputText value="#{anexo.usuario.fiplanUsuario.nome}" />
						</p:column>

						<p:column headerText="Anexo"
							style="white-space: normal; word-wrap: break-word;">
							<h:outputText value="#{anexo.descricao}" />
						</p:column>

						<p:column width="90" headerText="Ações">
							<center>
								<p:commandButton id="downloadAnexo" immediate="true"
									ajax="false" title="Download Anexo"
									icon="ui-icon-edit fa fa-download white Fs10"
									onclick="PrimeFaces.monitorDownload(start, stop);"
									actionListener="#{manterOcorrenciaBean.anexoBeanHelper.downloadAnexo(anexo)}">
									<p:fileDownload
										value="#{manterOcorrenciaBean.anexoBeanHelper.file}" />
								</p:commandButton>

								<p:commandButton icon="fa fa-trash white Fs10"
									action="#{manterOcorrenciaBean.removerAnexoAcaoCoordenadoria(anexo)}"
									process="@([id$=idAnexosAcaoCoordenadoria])"
									update="@([id$=idAnexosAcaoCoordenadoria]) @([id$=dlgConfirmAnexo])"
									rendered="#{(manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and anexo.id eq null}">
									<p:confirm header="Excluir Anexo"
										message="Deseja realmente excluir o anexo?"
										icon="ui-icon-alert" />
								</p:commandButton>
							</center>
						</p:column>
					</p:dataTable>
					<div class="ui-grid-row">
						<!-- 20971520 = 20 Megabyte	-->
						<p:fileUpload id="fileuploadAnexo" label="Anexar"
							cancelLabel="Cancelar" widgetVar="fileuploadAnexo"
							styleClass="ui-icon-cloud-upload Container100 Responsive100"
							process="@form" sizeLimit="20971520" auto="true" immediate="true"
							invalidSizeMessage="Tamanho máximo permitido 20MB "
							invalidFileMessage="Anexar apenas arquivo do tipo PDF, XLS, XLSX"
							multiple="true" allowTypes="/(\.|\/)(pdf|xls|xlsx)$/"
							fileUploadListener="#{manterOcorrenciaBean.uploadAnexoAcaoCoordenadoria}"
							rendered="#{(manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' or manterOcorrenciaBean.modoOperacao eq 'ALTERACAO') and manterOcorrenciaBean.ocorrencia.situacaoPendente and manterOcorrenciaBean.acaoCoordenadoria.id eq null}"
							update="@([id$=idAnexosAcaoCoordenadoria])" />
					</div>
				</cfw:container>

				<cfw:formSelectOneMenu id="situacaoAcaoCoordenadoria"
					labelValue="Situação" containerWidth="Container33"
					responsive="false"
					value="#{manterOcorrenciaBean.acaoCoordenadoria.situacao}"
					itemsValue="#{combosEnumHelperBean.dominioSituacao}"
					itemLabel="#{item.desc}" itemValue="#{item}" itemVar="item"
					readonly="#{!(manterOcorrenciaBean.modoOperacao eq 'ALTERACAO' and manterOcorrenciaBean.ocorrencia.situacaoPendente)}"
					required="false" />

				<cfw:formCalendar labelValue="Data de Cadastro"
					containerWidth="Container33 Responsive33"
					pattern="dd/MM/yyyy HH:mm:ss"
					value="#{manterOcorrenciaBean.acaoCoordenadoria.dataCriacao}"
					rendered="#{manterOcorrenciaBean.modoOperacao ne 'INCLUSAO'}"
					readonly="true" required="true" />

				<cfw:formCalendar labelValue="Data da Última Alteração"
					containerWidth="Container33 Responsive33"
					pattern="dd/MM/yyyy HH:mm:ss"
					value="#{manterOcorrenciaBean.acaoCoordenadoria.dataAtualizacao}"
					rendered="#{manterOcorrenciaBean.modoOperacao ne 'INCLUSAO'}"
					readonly="true" />

			</cfw:panelFloat>

			<cfw:panelButtons id="buttons">
				<p:outputPanel id="molduraBotoesAcaoCoordenadoria"
					styleClass="ui-ceprofw-panel-botoes" layout="block">

					<p:commandButton value="Concluir"
						actionListener="#{manterOcorrenciaBean.closeAcaoCoordenadoria}"
						process="@([id$=dlgFormAcaoCoordenadoria])"
						update="@([id$=panelAcaoCoordenadoria]) @([id$=tableAcaoCoordenadoria]) @([id$=idMessageFormAcaoCoordenadoria])"
						icon="fa fa-plus white Fs14" styleClass="ResponsiveButton"
						rendered="#{manterOcorrenciaBean.modoOperacao eq 'ALTERACAO' and manterOcorrenciaBean.ocorrencia.situacaoPendente}"
						onstart="showWaitStatus()" oncomplete="hideWaitStatus()">
					</p:commandButton>

					<p:commandButton value="Concluir"
						actionListener="#{manterOcorrenciaBean.incluirAcaoCoordenadoria}"
						process="@([id$=dlgFormAcaoCoordenadoria])"
						update="@([id$=panelAcaoCoordenadoria]) @([id$=tableAcaoCoordenadoria]) @([id$=idMessageFormAcaoCoordenadoria])"
						icon="fa fa-plus white Fs14" styleClass="ResponsiveButton"
						rendered="#{manterOcorrenciaBean.modoOperacao eq 'INCLUSAO' and manterOcorrenciaBean.ocorrencia.situacaoPendente}"
						onstart="showWaitStatus()" oncomplete="hideWaitStatus()" />

					<p:commandButton value="Limpar"
						actionListener="#{manterOcorrenciaBean.limparAcaoCoordenadoria}"
						process="@([id$=dlgFormAcaoCoordenadoria])"
						update="@([id$=panelAcaoCoordenadoria]) @([id$=tableAcaoCoordenadoria]) @([id$=idMessageFormAcaoCoordenadoria])"
						styleClass="ResponsiveButton"
						rendered="#{manterOcorrenciaBean.modoOperacao eq 'INCLUSAO'and manterOcorrenciaBean.ocorrencia.situacaoPendente}"
						onstart="showWaitStatus()" oncomplete="hideWaitStatus()" />

					<p:commandButton value="Cancelar" title="Cancelar" process="@this"
						update="@([id$=dlgFormAcaoCoordenadoria])"
						actionListener="#{manterOcorrenciaBean.closeAcaoCoordenadoria}"
						icon="fa fa-close white Fs14" />
				</p:outputPanel>
			</cfw:panelButtons>
		</cfw:panel>
	</p:dialog>
</ui:composition>